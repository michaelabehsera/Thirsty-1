<div id="upgrade-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Upgrade Your Plan</h3>
  </div>
  <div class="modal-body">
    <select id="plan">
      <% Cocktail.all.each do |cocktail| %>
        <option value="thirsty_<%= cocktail.price %>"><%= cocktail.title.gsub('<h2>', '').gsub('</h2>', '') %></option>
      <% end %>
    </select>
  </div>
  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <%= link_to 'Upgrade', "/campaigns/#{campaign.uuid}/upgrade", remote: true, class: 'accept btn btn-success' %>
  </div>
</div>

<div id="request-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Request Edits</h3>
  </div>
  <div class="modal-body">
    <%= form_tag "/campaigns/#{campaign.uuid}/request_edit", remote: true do %>
      <%= text_area_tag :request, '', placeholder: 'enter your request here' %>
      <%= hidden_field_tag :id, '', class: 'hidden' %>
    <% end %>
  </div>
  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <button class="btn btn-success" data-dismiss="modal" onclick="javascript:$('#request-modal form').submit()">Send Request</button>
  </div>
</div>

<div id="update-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Update Company Info</h3>
  </div>

  <div class="modal-body">
    <%= form_for :campaign, url: "/campaigns/#{campaign.uuid}/update", html: { remote: true } do |f| %>
      <%= f.text_field :title, placeholder: 'Company name', autocomplete: 'off', value: campaign.title %>
      <%= f.text_field :url, placeholder: 'Blog URL', autocomplete: 'off', value: campaign.url %>
      <%= f.text_field :username, placeholder: 'Wordpress username', autocomplete: 'off', value: campaign.username %>
      <%= f.password_field :pass, placeholder: 'Wordpress password', autocomplete: 'off', value: campaign.pass %>
      <%= f.text_field :analytics_id, placeholder: 'Google analytics site id (UA-XXXXXXX-X)', autocomplete: 'off', value: campaign.analytics_id %>
      <%= text_field_tag :tags, '', placeholder: 'Comma-separated tags describing your campaign', autocomplete: 'off', value: campaign.tags.map{|t|t.name}.join(', ') %>
    <% end %>
  </div>
  <div class="modal-footer">
  </div>

  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <button class="btn btn-success" data-dismiss="modal" onclick="javascript:$('#update-modal form').submit()">Update</button>
  </div>
</div>

<div id="article-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3></h3>
  </div>

  <div class="modal-body">
      <div id="article-content"></div>
      <div id="article-bio"></div>
  </div>

  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <%= link_to 'Deny', '', remote: true, class: 'deny btn btn-danger' %>
    <%= link_to 'Accept', '', remote: true, class: 'accept btn btn-success', onclick: "javascript:$('#article-modal .btn-success').text('Accepting..')" %>
  </div>
</div>

<div id="new-theme-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Install a new theme</h3>
  </div>

  <div class="modal-body">
    <%= form_for :theme, url: "/install_theme" do |f| %>
      <%= text_area_tag :url, '', placeholder: 'theme url' %>
      <%= f.text_area :title, placeholder: 'title' %>
      <%= f.text_area :description, placeholder: 'description' %>
      <%= f.file_field :image %>
    <% end %>
  </div>

  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <%= content_tag :button, 'Submit', class: 'btn btn-success', onclick: "javascript:$('#new-theme-modal form').submit();$('#new-theme-modal .btn-success').text('Submitting..')" %>
  </div>
</div>

<div id="new-plugin-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Install a new plugin</h3>
  </div>

  <div class="modal-body">
    <%= form_for :plugin, url: "/install_plugin" do |f| %>
      <%= text_area_tag :url, '', placeholder: 'plugin url' %>
      <%= f.text_area :title, placeholder: 'title' %>
      <%= f.text_area :description, placeholder: 'description' %>
      <%= f.file_field :image %>
    <% end %>
  </div>

  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <%= content_tag :button, 'Submit', class: 'btn btn-success', onclick: "javascript:$('#new-plugin-modal form').submit();$('#new-plugin-modal .btn-success').text('Submitting..')" %>
  </div>
</div>

<div id="desc-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Edit Campaign Tags</h3>
  </div>

  <div class="modal-body">
    <%= form_tag "/campaigns/#{campaign.uuid}/update_desc", remote: true do %>
      <%= text_field_tag :tags, campaign.tags %>
    <% end %>
  </div>

  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <%= content_tag :button, 'Submit', class: 'btn btn-success', onclick: "javascript:$('#desc-modal form').submit();$('#desc-modal .btn-success').text('Submitting..')" %>
  </div>
</div>

<div id="guidelines-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Edit Campaign Guidelines</h3>
  </div>

  <div class="modal-body">
    <%= form_tag "/campaigns/#{campaign.uuid}/update_guidelines", remote: true do %>
      <%= text_area_tag :guidelines, campaign.guidelines %>
    <% end %>
  </div>

  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <%= content_tag :button, 'Submit', class: 'btn btn-success', onclick: "javascript:$('#guidelines-modal form').submit();$('#guidelines-modal .btn-success').text('Submitting..')" %>
  </div>
</div>


<div id="headline-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Submit Your Headline</h3>
  </div>

  <div class="modal-body">
    <%= form_tag "/campaigns/#{campaign.uuid}/headline", remote: true do %>
      <%= text_field_tag :headline, '', placeholder: 'enter your headline' %>
    <% end %>
  </div>

  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <%= content_tag :button, 'Submit', class: 'btn btn-success', onclick: "javascript:$('#headline-modal form').submit();$('#headline-modal .btn-success').text('Submitting..')" %>
  </div>
</div>

<div id="image-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Upload Image</h3>
  </div>

  <div class="modal-body">
    <%= form_for :campaign, url: "/campaigns/#{campaign.uuid}/upload_image" do |f| %>
      <%= f.file_field :image %>
    <% end %>
  </div>

  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <%= content_tag :button, 'Submit', class: 'btn btn-success', onclick: "javascript:$('#image-modal form').submit();$('#image-modal .btn-success').text('Submitting..')" %>
  </div>
</div>

<div id="plugin-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Install Plugin</h3>
  </div>

  <div class="modal-body">
    <%= form_tag "/campaigns/#{campaign.uuid}/install", remote: true do %>
      <%= hidden_field_tag :pid %>
      <%= text_field_tag :fuser, '', placeholder: 'ftp username', autocomplete: 'off' %>
      <%= text_field_tag :fpass, '', placeholder: 'ftp password', autocomplete: 'off' %>
      <%= text_field_tag :fdomain, '', placeholder: 'ftp domain/ip' %>
      <%= text_field_tag :root, '', placeholder: 'wordpress root directory' %>
    <% end %>
  </div>

  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <%= content_tag :button, 'Submit', class: 'plugin-submit btn btn-success', onclick: "javascript:$('#plugin-modal form').submit();$('#plugin-modal .btn-success').text('Submitting..')" %>
  </div>
</div>

<div id="theme-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Install Theme</h3>
  </div>

  <div class="modal-body">
    <%= form_tag "/campaigns/#{campaign.uuid}/theme", remote: true do %>
      <%= hidden_field_tag :tid %>
      <%= text_field_tag :fuser, '', placeholder: 'ftp username', autocomplete: 'off' %>
      <%= password_field_tag :fpass, '', placeholder: 'ftp password', autocomplete: 'off' %>
      <%= text_field_tag :fdomain, '', placeholder: 'ftp domain/ip' %>
      <%= text_field_tag :root, '', placeholder: 'wordpress root directory' %>
    <% end %>
  </div>

  <div class="modal-footer">
    <%= content_tag :button, 'Close', :'data-dismiss' => 'modal', class: 'btn' %>
    <%= content_tag :button, 'Submit', class: 'plugin-submit btn btn-success', onclick: "javascript:$('#theme-modal form').submit();$('#theme-modal .btn-success').text('Submitting..')" %>
  </div>
</div>


<div id="analytics-modal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Analytics</h3>
  </div>

  <div class="modal-body">
    Loading...
  </div>

  <div class="modal-footer">
    <button class="btn" data-dismiss="modal">Close</button>
  </div>
</div>

<div id="idea-sub" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Submit an idea</h3>
  </div>

  <div class="modal-body">
    <%= form_for :comment, url: "/campaigns/#{campaign.uuid}/create_comment", html: { remote: true, class: 'form-horizontal', style: 'text-align:center' } do |f| %>
      <%= hidden_field_tag :id, campaign.id %>
      <div class="control-group">
        <div class="controls" style="margin-left:0">
          <%= f.text_field :title, placeholder: 'Title', style: 'width: 350px' %>
        </div>
      </div>
      <div class="control-group">
        <div class="controls" style="margin-left:0">
          <%= f.text_area :message, placeholder: 'Explanation', style: 'height: 150px; width: 350px' %>
        </div>
      </div>
  </div>

  <div class="modal-footer" style="text-align:center">
      <%= f.submit :submit, value: 'Submit idea', class: 'btn btn-success', style: 'float:none', onclick: 'javascript:$(this).val("Submitting..")' %>
    <% end %>
  </div>
</div>

<%= render partial: 'site/header' %>
      <div id="wrap">
          <div id="company_menu">
              <h1>Campaign Type: <%= campaign.cocktail.title %>
              <a href="#update-modal" data-toggle="modal">Update Campaign Info</a>
              </h1>
              <% if campaign.stripe_id %><a href="#upgrade-modal" data-toggle="modal" class="btn btn-primary">Upgrade</a><% end %>
          </div>
          <div class="tabbable">
          <div id="menu_one">

            <ul class="nav nav-tabs" data-tabs="tabs">
              <li class="active"><a href="#info-tab" data-toggle="tab">Company Info</a></li>
              <li><a href="#goals-tab" data-toggle="tab">Monthly Goals</a></li>
              <li><a href="#guidelines-tab" data-toggle="tab">Editorial Guidelines</a></li>
            </ul>

          </div>



          <div id="company_info">

            <div class="tab-content">

              <div id="info-tab" class="tab-pane active">
                <div id="campaign_image">
                <% if campaign.image && campaign.image.url %>
                  <img src="<%= campaign.image %>" style="margin:1px 10px 0 0" align="left">
                <% elsif current_user == campaign.user %>
                  <img id="campaign_image" src="/images/no_image.jpg" style="height:50px;width:50px;margin:1px 10px 0 0" align="left">
                <% end %>
                </div>
                <h1><%= campaign.title %></h1>
                <p>Tags For This Campaign: <%= campaign.tags.map{|t|t.name}.join(', ') %></p>
                <% if current_user == campaign.user || current_user.email == 'michaelabehsera@gmail.com' %>
                  <%= link_to 'edit', '#desc-modal', :'data-toggle' => 'modal' %>
                <% end %>
              </div>

            <div id="guidelines-tab" class="tab-pane">
                <p><%= campaign.guidelines %></p>
                <% if current_user == campaign.user || current_user.email == 'michaelabehsera@gmail.com' %>
                  <%= link_to 'edit', '#guidelines-modal', :'data-toggle' => 'modal' %>
                <% end %>
            </div>

              <div id="goals-tab" class="tab-pane">
                <% campaign.goals.each do |goal| %>
                  <div class="goal">
                    <% if goal.type == :traffic %>
                      <p style="border:none;display:inline"><%= goal.num %> additional unique visitors</p>
                    <% else %>
                      <p style="border:none;display:inline"><%= pluralize goal.num, goal.type.to_s %></p>
                    <% end %>
                    <% if goal.achieved %>
                      <div class="label label-success" style="display:inline">achieved</div>
                    <% else %>
                      <div class="label label-important" style="display:inline">not achieved</div>
                    <% end %>
                  </div>
                <% end %>
              </div>

            </div>

          </div>
          </div>
          <div style="margin-bottom:10px" id="timer"><h1><%= distance_of_time_in_words Time.now, campaign.end_date %> left to accomplish campaign goals.</h1></div>
          <% help = current_user.helps.where(campaign_id: campaign.id).first %>
          <% unless help && help.inactive %>
          <div id="guide_box" class="carousel" style="position:relative;">
            <div class="carousel-inner">
              <% if current_user == campaign.user || current_user.email == 'michaelabehsera@gmail.com' %>
                <div class="active item" selector="approve">
                  <h1>Approve Articles</h1>
                  <p>Review article ideas and completed articles. Approve the ones you like; reject the ones you don’t.</p>
                </div>
              <div class="item" selector="tools">
                <h1>Plugins</h1>
                <p>Install the latest WordPress plugins and themes to your blog with just one click!</p>
              </div>
              <div class="item" selector="reports">
                <h1>Reports</h1>
                <p>View the latest status updates from your campaign.</p>
              </div>
              <% else %>
                <div class="active item" selector="articles">
                  <h1>Articles</h1>
                  <p>Submit your ideas for articles for this campaign. Once approved, you can write your articles here and publish them. Your article will compete against two others to see which performs best. Winning article gets $50!</p>
                </div>
              <% end %>
              <div class="item" selector="chat">
                <h1>Chat</h1>
                <p>Join the conversation! Interact with clients, marketers, and other writers to share ideas and discuss campaigns.</p>
              </div>
              <div class="item" selector="writers">
                <h1>Writers</h1>
                <% if current_user == campaign.user %>
                <p>Check out our unbiased, real-time rankings of Thirsty writers based on their performance (traffic, unique impressions, social media shares, etc.).</p>
                <% else %>
                <p>How do you stack up against your fellow writers? Below, you’ll see our unbiased, real-time rankings of Thirsty writers based on performance (traffic, unique impressions, social media shares, etc.).</p>
                <% end %>
                </div>
              <div class="item" selector="analytics">
                <h1>Analytics</h1>
                <% if current_user != campaign.user %>
                <p>Monitor the performance of campaigns you’re working on in real time. Writers, see how your articles are performing against others. Marketers, track the number of clicks you’re generating on the content you’re promoting.</p>
                <% else %>
                <p>Track the performance of your campaign in real time with traffic reports, writer rankings, marketer rankings, and much more.</p>
                <% end %>
              </div>
            </div>
            <div style="position:absolute;right:0;bottom:-30px">
              <a style="margin-left:2px" class="orange_button close_button" href="javascript:void(0)">Close</a>
              <a style="margin-left:2px" class="blue_button" href="#guide_box" data-slide="prev">Previous</a>
              <a style="margin-left:2px" class="blue_button" href="#guide_box" data-slide="next">Next</a>
            </div>
          </div>
          <% end %>

       <div class="tabbable">

       <div id="marketers_tab">

       <p>Marketers:</p>


          <ul class="nav nav-tabs" data-tabs="tabs">
            <% if current_user == campaign.user || current_user.email == 'michaelabehsera@gmail.com' %>
              <li id="approve-link" class="active"><a tabname="approve" href="#approve-tab" data-toggle="tab">Approve articles</a></li>
              <li><a tabname="tools" href="#tools-tab" data-toggle="tab">Wordpress Addons</a></li>
              <li><a tabname="reports" href="#reports-tab" data-toggle="tab">Reports</a></li>
            <% end %>
            <% if current_user != campaign.user || current_user.email == 'michaelabehsera@gmail.com' %>
              <li id="articles-link" class="active"><a tabname="articles" href="#articles-tab" data-toggle="tab">Article submissions</a></li>
              <li id="myarticles-link"><a tabname="myarticles" href="#myarticles-tab" data-toggle="tab">My Articles</a></li>
            <% end %>
            <li><a tabname="writers" href="#writers-tab" data-toggle="tab">Writers</a></li>
            <li><a tabname="chat" href="#chat-tab" data-toggle="tab">Chat</a></li>
            <li><a tabname="analytics" href="#analytics-tab" data-toggle="tab">Analytics</a></li>
          </ul>
        </div>

          <div class="tab-content">

            <% if current_user != campaign.user || current_user.email == 'michaelabehsera@gmail.com' %>
            <div id="articles-tab" class="tab-pane active">
                <div class="subheader">
                  <h3 style="display:inline-block; margin-top:5px;">Have an article idea?</h3>
                  <button style="margin:-9px 0 0 10px" href="#headline-modal" class="orange_button" data-toggle="modal">Submit your headline!</button>
                </div>
              <div id="articles">
                <%= text_field_tag :title, '', placeholder: 'Title', style: 'width:760px' %>
                <%= text_area_tag :'send-area', '', style: 'width:767px;height:225px;display:block' %>
                <%= text_area_tag :'bio', '', style: 'width:767px;height:75px;display:block' %>
                <%= text_field_tag :tags, '', style: 'width:760px', placeholder: 'Comma-separated list of tags' %>
                <%= hidden_field_tag :edit, 'false' %>
                <%= hidden_field_tag :aid %>
                <%= link_to 'Submit your article', 'javascript:void(0)', id: 'send', class: 'blue_button', style: 'margin-top: 3px; float:right;' %>
              </div>
            </div>
        <% end %>
        <div id="myarticles-tab" class="tab-pane">
          <div id="myarticles">
            <% articles = current_user.articles.where(campaign_id: campaign.id).reverse %>
            <% articles.each do |article| %>
                      <div class="article" id="article<%= article.id %>">
                         "<%= article.title %>": written
                         <%= distance_of_time_in_words Time.now, article.created_at %> ago
                         -- 
                         <% if article.approved %>
                         <span class="approved-status approved">Approved</span>
                         <% elsif article.approved == false %>
                         <span class="approved-status denied">Denied</span>
                         <% else %>
                         <span class="approved-status in-review">In Review</span>
                         <%= link_to 'edit', 'javascript:void(0)', class: 'edit', aid: article.id %>
                         <% end %>
                       </div>
                  <% if articles.count == 0 %>
                    no articles
                  <% end %>
            <% end %>
          </div>
        </div>
        <% if current_user == campaign.user || current_user.email == 'michaelabehsera@gmail.com' %>
                  <div id="approve-tab" class="tab-pane active">
                      <div id="approve">
                  <div id="unread-articles">
                    <% campaign.headlines.desc(:created_at).each do |headline| %>
                      <div class="article" id="headline<%=headline.id%>">
                         <%= headline.user.name %> suggested the headline "<%= headline.title %>"
                         <%= distance_of_time_in_words Time.now, headline.created_at %>
                         -- 
                         <% if headline.approved %>
                         <span class="approved-status approved">Approved</span>
                         <% elsif headline.approved == false %>
                         <span class="approved-status denied">Denied</span>
                         <% else %>
                         <%= link_to 'accept', "/campaigns/#{campaign.uuid}/approve_headline?id=#{headline.id}", remote: true, class: 'accept' %>
                         <%= link_to 'deny', "/campaigns/#{campaign.uuid}/deny_headline?id=#{headline.id}", remote: true, class: 'deny' %>
                         <% end %>
                      </div>
                    <% end %>
                    <% campaign.articles.desc(:created_at).each do |article| %>
                      <div class="article" id="article<%= article.id %>">
                         "<%= article.title %>" was written by: <%= article.user.name %>
                         <%= distance_of_time_in_words Time.now, article.created_at %> ago
                         -- 
                         <% if article.approved %>
                         <span class="approved-status approved">Approved</span>
                         <% elsif article.approved == false %>
                         <span class="approved-status denied">Denied</span>
                         <% else %>
                         <%= link_to 'accept', "/campaigns/#{campaign.uuid}/approve?id=#{article.id}", remote: true, class: 'accept' %>
                         <%= link_to 'deny', "/campaigns/#{campaign.uuid}/deny?id=#{article.id}", remote: true, class: 'deny' %>
                         <% end %>
                         <%= link_to 'view', 'javascript:void(0)', class: 'view', aid: article.id %>
                         <%= link_to 'request edits', '#request-modal', :'data-toggle' => 'modal', class: 'request', aid: article.id %>
                       </div>
                    <% end %>
                  <% if campaign.articles.count == 0 && campaign.headlines.count == 0 %>
                    no articles
                  <% end %>
                  </div>
                  </div>
                  </div>
                <% end %>

            <div id="tools-tab" class="tab-pane">
              <div id="tools">
                <% if current_user.admin %>
                  <%= link_to 'Add new plugin', '#new-plugin-modal', :'data-toggle' => 'modal', class: 'btn btn-primary' %>
                  <%= link_to 'Add new theme', '#new-theme-modal', :'data-toggle' => 'modal', class: 'btn btn-primary' %>
                <% end %>
                <% Plugin.all.each do |plugin| %>
                  <div class="tool" id="plugin<%= plugin.id %>">
                    <%= plugin.title %>
                    <img align="left" src="<%= plugin.image %>">
                    <p><%= plugin.description%></p>
                    <%= link_to 'install', '#plugin-modal', :'data-toggle' => 'modal', class: 'plugin-link', pid: plugin.id, filename: plugin.filename %>
                    <%= link_to 'download', "/wordpress/plugins/#{plugin.filename}" %>
                  </div>
                <% end %>
                <% Theme.all.each do |plugin| %>
                  <div class="tool" id="plugin<%= plugin.id %>">
                    <%= plugin.title %>
                    <img align="left" src="<%= plugin.image %>">
                    <p><%= plugin.description%></p>
                    <%= link_to 'install', '#theme-modal', :'data-toggle' => 'modal', class: 'theme-link', tid: plugin.id, filename: plugin.filename %>
                    <%= link_to 'download', "/wordpress/themes/#{plugin.filename}" %>
                  </div>
                <% end %>
              </div>
            </div>

            <div id="reports-tab" class="tab-pane">
              <div id="reports_menu">
                <div id="devider_line2"></div>
                <h1><%= campaign_notifications.size %> Reports</h1>
              </div>
              <div id="reports"><%= render campaign_notifications %></div>
            </div>

            <div id="writers-tab" class="tab-pane">
              <div id="winning_writers">
                <h1 style="display:inline">Writers organized by the best results</h1>
                <% if current_user == campaign.user %>
                  <%= link_to 'Update results', "/campaigns/#{campaign.uuid}/auth", class: 'btn btn-primary' %>
                <% end %>
              </div>
              <div id="devider_line3"></div>
              <div id="writers"><%= render campaign.articles.where(month: campaign.month, approved: true).desc(:unique_pageviews) %></div>
              <div id="devider_end2"></div>
            </div>

            <div id="analytics-tab" class="tab-pane">
              <div id="analytics">
                <% articles = campaign.articles.where(month: campaign.month, approved: true).desc(:unique_pageviews) %>
                <% if articles.count > 0 %>
                  <% articles.each do |article| %>
                    <div class="article">
                      <%= link_to article.title, '#analytics-modal', :'data-toggle' => 'modal', class: 'analytics-link', aid: article.id %>
                    </div>
                  <% end %>
                <% else %>
                  no articles
                <% end %>
              </div>
            </div>


            <div id="chat-tab" class="tab-pane">
              <div id="chat">
                <div id="users">
                  <div>People in this room</div>
                  <% campaign.subscriptions.each do |user| %>
                    <div class="user" id="user<%= user.id %>"><%= user.name %></div>
                  <% end %>
                </div>
                <div id="chat_messages">
                <% campaign.chats.each do |chat| %>
                  <div class="chat_message">
                    <span class="timestamp">[<%= chat.timestamp %>]</span>
                    <span class="username"><%= chat.user.name %>: </span>
                    <span class="message_content"><%= chat.message %></span>
                  </div>
                <% end %>
                </div>
                <%= form_tag "/campaigns/#{campaign.uuid}/chat_message", id: 'chat_form', remote: true do %>
                  <%= text_field_tag :message, '', style: 'width:647px' %>
                  <%= submit_tag :submit, style: 'display:none' %>
                <% end %>
              </div>
            </div>

          </div>
        </div>

        </div>

<script>
  $(document).ready(function(){
    $('.nav-tabs li a').click(function(){
      $('.carousel-inner div').removeClass('active')
      $('.carousel-inner div[selector="' + $(this).attr('tabname') + '"]').addClass('active')
    })
    $('#guide_box .close_button').click(function(){
      $('#guide_box').fadeOut('slow')
      $.post('/campaigns/<%=campaign.uuid%>/help')
    })
    $('#guide_box').bind('slide', function(){
      setTimeout(function(){
        $('.nav-tabs li').removeClass('active')
        $('.tab-content').children('div').removeClass('active')
        $('.nav-tabs a[tabname="' + $('#guide_box .active').attr('selector') + '"]').parent().addClass('active')
        $('.tab-content #' + $('#guide_box .active').attr('selector') + '-tab').addClass('active')
      }, 750)
    })
    $('.edit').click(function(){
      $('.nav-tabs li').removeClass('active')
      $('.tab-content').children('div').removeClass('active')
      $('#articles-link').addClass('active')
      $('#articles-tab').addClass('active')
      $.post(
        '/campaigns/<%=campaign.uuid%>/edit_article',
        { id: $(this).attr('aid') },
        function(rsp) {
          console.log(rsp)
          $('#title').val(rsp.title)
          $('#tags').val(rsp.tags)
          $('.nicEdit-main').first().html(rsp.content)
          $('#edit').val('true')
          $('#aid').val(rsp.id)
        }, 'json'
      )
    })
    $('#campaign_image').click(function(){
      $('#image-modal').modal()
      $('#image-modal').modal('show')
    })
    $('.plugin-link').click(function(){
      $('#pid').val( $(this).attr('tid') )
      $('.plugin-submit').text('Submit')
    })
    $('.theme-link').click(function(){
      $('#tid').val( $(this).attr('tid') )
      $('.plugin-submit').text('Submit')
    })
    $('.analytics-link').click(function(){
      $.post(
        '/campaigns/analytics',
        { id: $(this).attr('aid') },
        function(rsp){ $('#analytics-modal .modal-body').html(rsp) },
        'html'
      )
    })
    $('.article .accept').live('click', function(){
      setTimeout(function(){
        $(this).attr('href', '')
      }, 500)
      $(this).text('accepting..')
      $(this).parent().children('.deny').remove()
    })
    $('.article .deny').live('click', function(){
      setTimeout(function(){
        $(this).attr('href', '')
      }, 500)
      $(this).text('denying..')
      $(this).parent().children('.accept').remove()
    })
    function new_message(message, username, timestamp) {
        return '<div class="chat_message"><span class="timestamp">[' + timestamp + ']</span> <span class="username">' + username + ': </span><span class="message_content">' + message + '</span></div>'
    }

    var jug = new Juggernaut({port: '8081'})
    jug.meta = {
      user_id: '<%= current_user.id %>',
      campaign_id: '<%= campaign.id %>'
    }

    jug.subscribe('<%= campaign.uuid %>', function(data) {
      if (data.message && data.message != '') {
        $('#chat_messages').append(new_message(data.message, data.username, data.timestamp))
        $('#chat_messages').scrollTop($('#chat_messages')[0].scrollHeight)
        $('#message').val('')
      } else if (data.event_type == 'subscribe') {
        $('#users').append('<div class="user" id="user' + data.user_id + '">' + data.username + '</div>')
      } else if (data.event_type == 'unsubscribe') {
        $('#user' + data.user_id).fadeOut()
      } else if (data.event_type == 'install_success') {
        $('.plugin-submit').html('installed!')
      } else if (data.event_type == 'install_failure') {
        $('.plugin-submit').html('failed :(')
      }
    })

    var session_check = setInterval(function(){
      if (jug.sessionID) {
        clearInterval(session_check)
        $('#chat_form').append('<input type="hidden" name="sessionID" value="' + jug.sessionID + '">')
      }
    }, 100)

    $('#chat_form').submit(function(){
      var message = $('#message').val()
      date = new Date()
      hour = date.getHours().toString()
      minute = date.getMinutes()
      if (minute < 10) {
        minute = '0' + minute.toString()
      } else {
        minute = minute.toString()
      }
      timestamp = hour + ':' + minute
      if (message != '') {
        $('#chat_messages').append(new_message(message, '<%= current_user.name %>', timestamp))
        $('#chat_messages').scrollTop($('#chat_messages')[0].scrollHeight)
      }
    })

    $('#tool_form').submit(function(e){
      $('#link').attr('readonly', 'true')
    })

    <% if params[:article] %>
      $.post(
        '/campaigns/view',
        { id: '<%= params[:article] %>' },
        function(rsp) {
          $('#article-modal').modal()
          $('#article-modal').modal('show')
          $('#article-modal h3').text(rsp.title)
          $('#article-content').html(rsp.article)
          $('#article-bio').html(rsp.bio)
          $('#article-modal .btn-success').attr('href', '/campaigns/<%=campaign.uuid%>/approve?id=<%=params[:article]%>')
          $('#article-modal .btn-danger').attr('href', '/campaigns/<%=campaign.uuid%>/deny?id=<%=params[:article]%>')
        },
        'json'
      )
    <% end %>

    $('.request').click(function(){
      $('#request').val('')
      $('#request-modal form .hidden').val($(this).attr('aid'))
    })

    $('.view').click(function(){
      id = $(this).attr('aid')
      $.post(
        '/campaigns/view',
        { id: id },
        function(rsp) {
          $('#article-modal').modal()
          $('#article-modal').modal('show')
          $('#article-modal h3').text(rsp.title)
          $('#article-content').html(rsp.article)
          $('#article-bio').html(rsp.bio)
          $('#article-modal .btn-success').attr('href', '/campaigns/<%=campaign.uuid%>/approve?id=' + id)
          $('#article-modal .btn-danger').attr('href', '/campaigns/<%=campaign.uuid%>/deny?id=' + id)
        },
        'json'
      )
    })

    new nicEditor().panelInstance('send-area')
    new nicEditor().panelInstance('bio')
    $('.nicEdit-main').parent().css('background-color', 'white')
    $('.nicEdit-main').first().html('article')
    $('.nicEdit-main').last().html('<%= current_user.bio && escape_javascript(current_user.bio).html_safe || "bio" %>')
    $('#send').click(function(){
      $(this).text('Submitting..')
      $.post(
        '/campaigns/<%= campaign.uuid %>/submit',
        { edit: $('#edit').val(), id: '<%= current_user.id %>', content: $('.nicEdit-main').first().html(), tags: $('#tags').val(), title: $('#title').val(), bio: $('.nicEdit-main').last().html(), aid: $('#aid').val() },
        function(rsp){
          if (rsp.success == true) {
            $('#title').val('')
            $('.nicEdit-main').html('')
            $('#send').text('Submit')
            $('#articles-tab').prepend('<div style="margin-top:10px;width:100px" class="alert alert-success"><a data-dismiss="alert" class="close">x</a>Article submitted!</div>')
            if ( !($('#unread-articles').html().search('no articles') == -1)) {
              $('#unread-articles').html('')
            }
            $('#unread-articles').append('<div class="article" id="article' + rsp.id + '">' + rsp.title + ' written by: ' + rsp.name + ' <a href="/campaigns/<%=campaign.uuid%>/approve?id=' + rsp.id + '" data-remote="true" class="accept">accept</a> <a href="/campaigns/<%=campaign.uuid%>/deny?id=' + rsp.id + '" data-remote="true" class="deny">deny</a></div>')
          } else {
            $('#send').text('Failed :(')
          }
        },
        'json'
      )
    })
  })
</script>

<% if params[:article] %>
  <script>
      $.post(
        '/campaigns/analytics',
        { id: $(this).attr('aid') },
        function(rsp){
          $('#analytics-modal .modal-body').html(rsp)
          $('#analytics-modal').modal()
          $('#analytics-modal').modal('show')
        },
        'html'
      )
  </script>
<% end %>
